#! /bin/bash

FCREPO_VERSION="4.6.0"

case $1 in
    -h )
            echo '-----------------------------'
            echo 'fcrepo_wrapper startup script'
            echo '-----------------------------'
            echo 'This script starts fedora using fcrepo_wrapper for either ad hoc development through .internal_test app generated by `rake engine_cart:generate`'
            echo 'or for testing through rspec tests.'
            echo ''
            echo '-d start fedora for ad hoc development testing through .internal_test app generated by `rake engine_cart:generate`'
            echo '-t start fedora for testing through rspec tests'
            echo '-h show these help instructions'
            exit
            ;;
    -t ) 
            PORT="-p 8986"
            RUNPATH="$HOME/Services/fedoratest"
            DATADIR="$RUNPATH/data"
            ;;
    -d | * )
            PORT="-p 8984"
            RUNPATH="$HOME/Services/fedoradev"
            DATADIR="$RUNPATH/data"
            ;;
esac

RUNFILE="$RUNPATH/fcrepo-webapp-$FCREPO_VERSION-jetty-console.jar"
ACTION="install"
if [ -d $RUNPATH ] && [ -f $RUNFILE ]; then
    ACTION="run"
fi

CMD="fcrepo_wrapper $PORT -i $RUNPATH -d $DATADIR"
echo "Will run command:  $CMD"
QUESTION="Continue to $ACTION fedora at $RUNPATH? [y|n]"
while true; do
    echo $QUESTION
    read yn
    case $yn in
        [Yy]* ) break;;
        [Nn]* ) exit;;
        * ) echo "Please answer y for yes or n for no.";;
    esac
done

eval $CMD

